---
import { type CollectionEntry, getCollection } from "astro:content";
import Layout from "../../layouts/Layout.astro";
import { formatDate } from "../../lib/utils";
import GithubCommentScript from "./components/github-comment-script.astro";

export async function getStaticPaths() {
  const posts = await getCollection("posts");
  return posts.map((post: any) => ({
    params: { slug: post.slug },
    props: post,
  }));
}

type Props = CollectionEntry<"posts">;
const post = Astro.props;

const { Content } = await post.render();
---

<Layout
  title={post.data.title}
  description={post.data.description ?? ""}
  image={post.data.image}
>
  <article class="space-y-8">
    <header class="space-y-4 border-b border-zinc-200/60 pb-8 dark:border-zinc-800/60">
      <a
        href="/posts"
        class="inline-flex items-center gap-1.5 font-mono text-xs text-zinc-400 transition-colors hover:text-zinc-900 dark:text-zinc-600 dark:hover:text-zinc-100"
      >
        <svg class="h-3 w-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7" />
        </svg>
        Posts
      </a>

      <h1 class="text-2xl font-semibold tracking-[-0.02em] text-zinc-900 sm:text-3xl dark:text-zinc-100">
        {post.data.title}
      </h1>

      <div class="flex items-center gap-3">
        <time class="font-mono text-sm text-zinc-400 dark:text-zinc-600">
          {formatDate(post.data.date)}
        </time>
      </div>
    </header>

    <div class="prose-custom">
      <Content />
    </div>

    <footer class="border-t border-zinc-200/60 pt-8 dark:border-zinc-800/60">
      <GithubCommentScript />
    </footer>
  </article>
</Layout>

<style>
  .prose-custom {
    @apply text-zinc-700 dark:text-zinc-300;
  }
</style>
